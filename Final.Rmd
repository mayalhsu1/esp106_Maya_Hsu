---
title: "Untitled"
output:
  pdf_document: default
  html_document: default
date: "2023-03-06"
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE)

path <- "/Users/mayahsu/Desktop/school/environmental data science/"

knitr::opts_knit$set(root.dir = path)
setwd(path)
housing <- read.csv("final/ACSCP1Y2021.CP04-2023-03-06T224453.csv")
projected <- read.csv("https://data.ca.gov/dataset/81b0841f-2802-403e-b48e-2ef4b751f77c/resource/fe505d9b-8c36-42ba-ba30-08bc4f34e022/download/table-a2-annual-building-activity-report-summary-new-construction-entitled-permits-and-completed.csv")

library(tidyverse)
```

```{r}
#projects that where approved with SB35
i = projected$APPROVE_SB35 == "Y"
SB35 <- projected[i,]
#projects that have occupets 
i = SB35$CO_ISSUE_DT1 != ""
OC_sb35 <- SB35[i,]
```

```{r}
counties <- unique(SB35$CNTY_NAME)
counties <- sort(counties)
counties <- str_to_title(counties)
```

```{r}
housing <- t(housing) #transposing the data

headers <- housing[1, ] #extracted values from row 1 as a vector 
colnames(housing) <- headers #renamed columns with row 1 values
housing <- housing[-1, ] #removed first row
housing <- housing[-110, ] #removed row with blank data
```

```{r}
Years <- c("2021", "2019", "2018", "2017") #creating list of dates
Years <- rep(Years, 41) #repeating dates
as.data.frame(Years) #data frame
housing <- cbind(housing, Years) #adding dates to housing data
```

```{r}
County <- rownames(housing)
County <- substr(County, 1, nchar(County)-34)
as.data.frame(County)
County <- gsub(".", " ", County, fixed = TRUE)
rownames(housing) <- 1:nrow(housing)

housing <- gsub("N", NA, housing)
housing <- gsub("(X)", NA, housing)

housing <- cbind(housing, County)
```

```{r}
housing_type <- housing[ ,c(9:17)]
housing_type <- gsub("%", "", housing_type, fixed = TRUE)
housing_type <- as.data.frame(housing_type)
housing_type <- sapply(housing_type, as.numeric)
housing_type <- housing_type/100

housing_type <- as.data.frame(housing_type)

housing_type <- cbind(housing_type, housing[ ,161:162])
```

#Bay Area graph
```{r}
h2021 <- subset(housing_type, Years == "2021")
bay <- subset(h2021, County %in% c("SAN FRANCISCO", "SANTA CLARA", "MARIN", "ALAMEDA", "SOLANO", "CONTRA COSTA", "NAPA", "SONOMA", "SAN MATEO"))
names_bay <- bay[, 11]
bay <- subset(bay, select = -c(10, 11))

color <- c('#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00','#cab2d6')

bay <- as.matrix(bay)
bay <- t(bay)

par(mar=c(5.1,6,6,6)+.1, xpd = TRUE)
barplot(bay, horiz = TRUE, names.arg = names_bay, cex.names = 0.7, las = 1, col = color, main = "Housing Type by County in the Bay Area", xlab = "Proportion")
legend("right", inset = -0.28, legend = rownames(bay), fill = color, cex = 0.5, title = "Housing Type")
```

#Metro graph
```{r}
housing_type_2021 <- subset(housing_type, Years == "2021")
housing_type_metros <- subset(housing_type_2021, County %in% c("SAN FRANCISCO", "LOS ANGELES", "SAN DIEGO", "SACRAMENTO"))
names_metros <- housing_type_metros[, 11]
housing_type_metros <- subset(housing_type_metros, select = -c(10, 11))

color <- c('#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00','#cab2d6')

housing_type_metros <- as.matrix(housing_type_metros)
housing_type_metros <- t(housing_type_metros)

par(mar=c(5.1,6,6,6)+.1, xpd = TRUE)
barplot(housing_type_metros, horiz = TRUE, names.arg = names_metros, cex.names = 0.7, las = 1, col = color, main = "Housing Type by County", xlab = "Proportion")
legend("right", inset = -0.28, legend = rownames(housing_type_metros), fill = color, cex = 0.5, title = "Housing Type")
```

```{r}
h2021 <- subset(housing_type, Years == "2021")
housing_type_2021 <- subset(housing_type, Years == "2021")
sb35_housing_type <- subset(h2021, County %in% counties)
names_sb35 <- sb35_housing_type[, 11]
sb35_housing_type <- subset(sb35_housing_type, select = -c(10, 11))

color <- c('#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00','#cab2d6')

sb_type <- rownames(sb35_housing_type)
sb_type <- str_squish(sb_type)

sb35_housing_type <- as.matrix(sb35_housing_type)
sb35_housing_type <- t(sb35_housing_type)

#png(filename = "/Users/mayahsu/Desktop/school/environmental data science/final/Current Housing Data", width = 5, height = 5, units = "in", res = 300)
par(mar=c(4,5,5,5)+.1, xpd = TRUE)
barplot(sb35_housing_type, horiz = TRUE, names.arg = names_sb35, cex.names = 0.4, las = 1, col = color, main = "Housing Type in Counties With\nApproved SB35 Projects", cex.axis = 0.5, width = 1, cex.lab = 0.7, xlim = c(0,1), ylim = c(0, 32))
title(xlab = "Proportion", mgp = c(2, 1, 0), cex.lab = 0.7)
legend("right", inset = -0.19, legend = sb_type, fill = color, cex = 0.5, title = "Housing Type")
#dev.off()
```


```{r}
county_SB35 <- aggregate(SB35[, 29:35], by = list(SB35$CNTY_NAME), sum)
total <- table(SB35$CNTY_NAME)
total <- as.data.frame(total)
county_SB35 <- cbind(county_SB35, total[ ,2])
colnames(county_SB35)[colnames(county_SB35) == "total[ ,2]"] <- "Total"
demographic <- read.csv("final/county data.csv")

```

```{r}

```

```{r}
i <- (projected$TENURE_DESC == "Owner")&(projected$UNIT_CAT_DESC != "Single-Family Detached Unit")
table(i)

#compare low income developments to poverty rates by county
```

```{r}

```
